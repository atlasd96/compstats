---
title: "Atlas-PS 11"
author: "David Atlas"
date: "11/7/2018"
output: pdf_document
---

# Problem 1
We begin by reading in the data.
```{r}
data <- log(scan("./F12.txt"))
```

## a)
### Silverman's Rule of Thumb
We find $h_0$ via Silverman's Rule of Thumb, in which $h = \left(\frac{4}{3n}\right)^\frac{1}{5} \hat{\sigma}$, where $\hat{\sigma}$ is the sample standard deviation.
```{r}
silvermans_rule_of_thumb <- function(data){
  h <- (4 / (3 * length(data)))^(1/5) * sd(data)
  return(h)
}

silvermans_rule_of_thumb(data)
```

Silverman's Rule of Thumb yields $h_0 = .233$.

We plot the resulting density estimation over a histogram of the data.
```{r}
get_kernel_density <- function(x, data, K, h){
  n <- length(data)
  return(sum(sapply(data, function(X_i){
    return(K((x - X_i) / h))
  })) / (n  * h))
}

X <- seq(min(data), max(data), .01)
f_hat <- sapply(X, function(x) get_kernel_density(x, data, dnorm, h=silvermans_rule_of_thumb(data)))
hist(data, freq=F, ylim=c(0, .6))
lines(X, f_hat)

```

The density estimate here is pretty good. 

### Sheather-Jones Method
Next, we find an estimate of $h$ using the Sheather-Jones method. We 
take the $\hat{f}$ values that we found above, and take the ratio of $f$ second differences 
to those of $x$ to give an
estimate of the second derivative. We find the roughness of that function.
```{r}
derivative <- function(f_x, x){
  return(diff(f_x) / diff(x))
}

fprime <- derivative(f_hat, X)
f2prime <- derivative(fprime, X[2:length(X)])
R_k <- sum(dnorm(seq(min(data), max(data), .01))^2)
R_f2prime <- sum(f2prime^2)
n <- length(data)
h <- (R_k / (n * R_f2prime))^.2
```

Next, we find $\hat{f}$ using our value of $h=.202$.
```{r}
f_hat_sj <- sapply(X, function(x) get_kernel_density(x, data, dnorm, h=.202))
hist(data, freq=F, ylim=c(0, .6))
lines(X, f_hat, col='red')
lines(X, f_hat_sj, col='blue')
```
Here, we see the data with the density estimate yielded by Silverman's Rule of Thumb in red, with the density estimated by the Sheather-Jones method in blue. There is minimal difference between the two, as $h$ 
didn't vary much between the estimates.





